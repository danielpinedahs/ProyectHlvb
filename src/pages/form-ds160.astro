---
export const prerender = false;

import BaseLayout from "../layouts/BaseLayout.astro";
import { prisma } from "../lib/prisma";


const url = new URL(Astro.request.url);
const id = url.searchParams.get("id") || "";

const clientData = id
  ? await prisma.cLIENTS.findUnique({
      where: { ID_CLIENT: Number(id) }
    })
  : null;
---

<BaseLayout title="Formulario Completo">
  <h1>Formulario Completo de Clientes</h1>

  <p>¡El cliente ya existe! Por favor, actualiza los demás campos o inserta nuevos.</p>

  <form method="POST" action="/api/clientes-actualizar">
    <input type="hidden" name="id" value={id} />

    <label>Apellido:</label>
    <input type="text" name="ps_surname" value={clientData?.PS_SURNAME || ""} required />

    <label>Nombre:</label>
    <input type="text" name="ps_givnam" value={clientData?.PS_GIVNAM || ""} required />

    <label>Sexo:</label>
    <select name="ps_sex" required>
      <option value="">Seleccione</option>
      <option value="M" selected={clientData?.PS_SEX === "M"}>Masculino</option>
      <option value="F" selected={clientData?.PS_SEX === "F"}>Femenino</option>
    </select>

    <label>Email:</label>
    <input type="email" name="ps_email" value={clientData?.PS_EMAIL || ""} required />

    <fieldset>
      <legend>Fecha de nacimiento</legend>
      <label for="ps_dbirth">Fecha:</label>
      <input
        type="date"
        id="ps_dbirth"
        name="ps_dbirth"
        value={clientData?.PS_DBIRTH?.toISOString().split("T")[0] || ""}
        required
      />
    </fieldset>

    <label>País:</label>
    <input type="text" name="ps_country" value={clientData?.PS_COUNTRY || ""} />

    <button type="submit" class="boton-guardar">Actualizar/Insertar</button>
  </form>
</BaseLayout>